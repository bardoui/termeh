// see https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests
// see http://www.workwithcolor.com/
@use "sass:color";
@use "sass:math";
@use "func";

@function -normalize($v) {
    $v: math.div($v, 255);
    @return if(
        $v < 0.03928,
        math.div($v, 12.92),
        math.pow(math.div($v + 0.055, 1.055), 2.4)
    );
}

@function luminance($color) {
    $color: func.color-of($color, "luminance", "color");
    $red: -normalize(color.red($color));
    $green: -normalize(color.green($color));
    $blue: -normalize(color.blue($color));

    @return 0.2126 * $red + 0.7152 * $green + 0.0722 * $blue;
}

@function darkest-of($color1, $color2) {
    $color1: func.color-of($color1, "darkest-of", "color1");
    $color2: func.color-of($color2, "darkest-of", "color2");
    @return if(luminance($color1) < luminance($color2), $color1, $color2);
}

@function brightest-of($color1, $color2) {
    $color1: func.color-of($color1, "brightest-of", "color1");
    $color2: func.color-of($color2, "brightest-of", "color2");
    @return if(luminance($color1) > luminance($color2), $color1, $color2);
}

@function contrast-ratio($foreground, $background) {
    $foreground: func.color-of($foreground, "contrast-ratio", "foreground");
    $background: func.color-of($background, "contrast-ratio", "background");
    $luminance1: luminance($foreground) + 0.05;
    $luminance2: luminance($background) + 0.05;
    $ratio: math.div($luminance1, $luminance2);
    @if $luminance2 > $luminance1 {
        $ratio: math.div(1, $ratio);
    }
    @return $ratio;
}

@function tone($color) {
    $color: func.color-of($color, "tone", "color");
    $minCnt: 3.1;
    $lightCnt: contrast-ratio(
        darkest-of($color, white),
        brightest-of($color, white)
    );
    $darkCnt: contrast-ratio(
        darkest-of($color, rgba(black, 0.87)),
        brightest-of($color, rgba(black, 0.87))
    );
    @if ($lightCnt < $minCnt) and ($darkCnt > $lightCnt) {
        @return "light";
    } @else {
        @return "dark";
    }
}

@function contrast($base, $color1, $color2) {
    $base: func.color-of($base, "contrast", "base");
    $color1: func.color-of($color1, "contrast", "color1");
    $color2: func.color-of($color2, "contrast", "color2");
    $col1Cnt: contrast-ratio(
        darkest-of($base, $color1),
        brightest-of($base, $color1)
    );
    $col2Cnt: contrast-ratio(
        darkest-of($base, $color2),
        brightest-of($base, $color2)
    );
    @if $col1Cnt > $col2Cnt {
        @return $color1;
    } @else {
        @return $color2;
    }
}

@function harmony($base, $color1, $color2) {
    $base: func.color-of($base, "harmony", "base");
    $color1: func.color-of($color1, "harmony", "color1");
    $color2: func.color-of($color2, "harmony", "color2");
    $col1Cnt: contrast-ratio(
        darkest-of($base, $color1),
        brightest-of($base, $color1)
    );
    $col2Cnt: contrast-ratio(
        darkest-of($base, $color2),
        brightest-of($base, $color2)
    );
    @if $col1Cnt < $col2Cnt {
        @return $color1;
    } @else {
        @return $color2;
    }
}
